---
// Props: title, description, noindex (optional)
import Header from "../components/Header.astro";
import Footer from "../components/Footer.astro";
import "../styles/global.css";

const { title = "Bochi IT Note", description = "日本の中小企業向けSaaS選定の要件適合ナレッジとテンプレート", noindex = false } = Astro.props;
const GA_ID = import.meta.env.PUBLIC_GA_ID || 'G-97G7HCT99G';
---

<html lang="ja">
	<head>
		<meta charset="utf-8" />
		<meta name="viewport" content="width=device-width, initial-scale=1" />
		<link rel="icon" type="image/svg+xml" href="/favicon.svg" />
		<title>{title}</title>
		<meta name="description" content={description} />
		{noindex && <meta name="robots" content="noindex,nofollow" />}
		<meta property="og:title" content={title} />
		<meta property="og:description" content={description} />
		<meta property="og:type" content="website" />
		<link rel="canonical" href={`https://bochi-it-note.com${Astro.url.pathname}`} />
		<meta property="og:url" content={`https://bochi-it-note.com${Astro.url.pathname}`} />
		<script type="application/ld+json" is:inline>{JSON.stringify({
			"@context": "https://schema.org",
			"@type": "Organization",
			"name": "Bochi IT Note",
			"url": "https://bochi-it-note.com"
		})}</script>
		<script type="application/ld+json" is:inline>{JSON.stringify({
			"@context": "https://schema.org",
			"@type": "WebSite",
			"name": "Bochi IT Note",
			"url": "https://bochi-it-note.com",
			"potentialAction": {
				"@type": "SearchAction",
				"target": "https://bochi-it-note.com/search?q={search_term_string}",
				"query-input": "required name=search_term_string"
			}
		})}</script>
		{import.meta.env.PUBLIC_GSC_VERIFICATION && (
			<meta name="google-site-verification" content={import.meta.env.PUBLIC_GSC_VERIFICATION} />
		)}
		<script is:inline>
			(function(){
				function status(){ try{ return localStorage.getItem('cookie:consent') || 'unset'; }catch(e){ return 'unset'; } }
				function accept(){ try{ localStorage.setItem('cookie:consent','yes'); location.reload(); }catch(e){} }
				function decline(){ try{ localStorage.setItem('cookie:consent','no'); location.reload(); }catch(e){} }
				function openBanner(){
					try{
						if(document.getElementById('cookie-banner')) return;
						var b=document.createElement('div');
						b.id='cookie-banner';
						b.innerHTML='\n<div style="position:fixed;inset:auto 0 0 0;background:#111;color:#fff;padding:12px 16px;display:flex;gap:12px;align-items:center;justify-content:center;z-index:9999;font-size:12px;flex-wrap:wrap">本サイトは計測/アフィリエイトのためCookie等を使用します。<div style="display:flex;gap:8px;align-items:center"><button id="cc-accept" style="background:#fff;color:#111;padding:6px 10px;border-radius:4px;">同意</button><button id="cc-decline" style="background:transparent;color:#fff;padding:6px 10px;border:1px solid #fff;border-radius:4px;">拒否</button></div></div>';
						document.body.appendChild(b);
						document.getElementById('cc-accept').addEventListener('click', accept);
						document.getElementById('cc-decline').addEventListener('click', decline);
					}catch(e){}
				}
				window.__consentGranted = (status()==='yes');
				window.__grantConsent = accept;
				window.__revokeConsent = decline;
				window.__openConsent = function(){
					try{ localStorage.removeItem('cookie:consent'); }catch(e){}
					if(document.readyState==='loading') document.addEventListener('DOMContentLoaded', openBanner); else openBanner();
				};
			})();
		</script>
		{GA_ID && (
			<>
				<script async src={`https://www.googletagmanager.com/gtag/js?id=${GA_ID}`}></script>
				<script is:inline>
					(function(){
						var GA_ID = {JSON.stringify(GA_ID)};
						window.dataLayer = window.dataLayer || [];
						function gtag(){dataLayer.push(arguments);} window.gtag = window.gtag || gtag;
						gtag('consent','default',{
							ad_storage:'denied',
							analytics_storage:'denied',
							functionality_storage:'denied',
							personalization_storage:'denied',
							security_storage:'granted'
						});
						gtag('js', new Date());
						gtag('config', GA_ID, { 'anonymize_ip': true });
						if(window.__consentGranted){
							gtag('consent','update',{
								ad_storage:'granted',
								analytics_storage:'granted',
								functionality_storage:'granted',
								personalization_storage:'granted'
							});
						}
					})();
				</script>
			</>
		)}
		{import.meta.env.PUBLIC_SKIMLINKS_ID && (
			<script>
				if(window.__consentGranted){
					var s=document.createElement('script');
					s.async=true; s.src='https://s.skimresources.com/js/'+"{import.meta.env.PUBLIC_SKIMLINKS_ID}"+'.skimlinks.js';
					document.head.appendChild(s);
				}
			</script>
		)}
		<script is:inline>
			(function(){
				function assignVariant(){
					try{
						var key='ab:home-cta';
						var v=localStorage.getItem(key);
						if(!v){ v=Math.random()<0.5?'A':'B'; localStorage.setItem(key,v); }
						window.__variant=v;
						document.documentElement.setAttribute('data-variant', v);
					}catch(e){}
				}
				function sendEvent(detail){
					try{
						if(window.gtag){
							window.gtag('event','click',{event_category:'interaction',...detail});
							var ev = String(detail.name||'custom_click');
							window.gtag('event', ev, { event_category:'interaction', ...detail });
						}
						var k='stats:click:'+(detail.name||'unknown');
						var c=Number(localStorage.getItem(k)||'0')+1; localStorage.setItem(k,String(c));
					}catch(e){}
				}
				document.addEventListener('DOMContentLoaded',function(){
					assignVariant();
					document.addEventListener('click',function(e){
						var el=e.target && e.target.closest && e.target.closest('[data-track]');
						if(!el) return;
						sendEvent({
							name: el.getAttribute('data-track'),
							variant: window.__variant || 'A',
							href: el.getAttribute('href')||null,
							id: el.getAttribute('data-id')||null,
							slug: el.getAttribute('data-slug')||null,
							type: el.getAttribute('data-type')||null,
							page: location.pathname
						});
					}, {capture:true});
					if(!window.__consentGranted){ if(window.__openConsent) window.__openConsent(); }
					// consentが後から許可された場合、Consent Modeを更新
					document.addEventListener('consentgranted', function(){
						try{
							if(window.gtag){
								window.gtag('consent','update',{
									ad_storage:'granted',
									analytics_storage:'granted',
									functionality_storage:'granted',
									personalization_storage:'granted'
								});
							}
						}catch(e){}
					});
				});
			})();
		</script>
	</head>
	<body class="min-h-screen bg-white text-gray-900">
		<Header />
		<main class="mx-auto max-w-6xl px-4 py-8">
			<slot />
		</main>
		<Footer />
	</body>

</html>


