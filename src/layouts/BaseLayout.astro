---
// Props: title, description, noindex (optional)
import Header from "../components/Header.astro";
import Footer from "../components/Footer.astro";
import "../styles/global.css";

const { title = "Bochi IT Note", description = "日本の中小企業向けSaaS選定の要件適合ナレッジとテンプレート", noindex = false } = Astro.props;
---

<html lang="ja">
	<head>
		<meta charset="utf-8" />
		<meta name="viewport" content="width=device-width, initial-scale=1" />
		<link rel="icon" type="image/svg+xml" href="/favicon.svg" />
		<title>{title}</title>
		<meta name="description" content={description} />
		{noindex && <meta name="robots" content="noindex,nofollow" />}
		<meta property="og:title" content={title} />
		<meta property="og:description" content={description} />
		<meta property="og:type" content="website" />
		<link rel="canonical" href={`https://bochi-it-note.com${Astro.url.pathname}`} />
		<meta property="og:url" content={`https://bochi-it-note.com${Astro.url.pathname}`} />
		{import.meta.env.PUBLIC_GSC_VERIFICATION && (
			<meta name="google-site-verification" content={import.meta.env.PUBLIC_GSC_VERIFICATION} />
		)}
		<script is:inline>
			(function(){
				function getConsent(){ try{ return localStorage.getItem('cookie:consent')==='yes'; }catch(e){ return false; } }
				function setConsent(){ try{ localStorage.setItem('cookie:consent','yes'); location.reload(); }catch(e){} }
				window.__consentGranted = getConsent();
				window.__grantConsent = setConsent;
			})();
		</script>
		{import.meta.env.PUBLIC_GA_ID && (
			<>
				<script>
					if(window.__consentGranted){
						var s=document.createElement('script');
						s.async=true; s.src='https://www.googletagmanager.com/gtag/js?id='+"{import.meta.env.PUBLIC_GA_ID}";
						document.head.appendChild(s);
					}
				</script>
				<script is:inline>
					if(window.__consentGranted){
						window.dataLayer = window.dataLayer || [];
						function gtag(){dataLayer.push(arguments);} gtag('js', new Date());
						gtag('config', '{import.meta.env.PUBLIC_GA_ID}');
					}
				</script>
			</>
		)}
		{import.meta.env.PUBLIC_SKIMLINKS_ID && (
			<script>
				if(window.__consentGranted){
					var s=document.createElement('script');
					s.async=true; s.src='https://s.skimresources.com/js/'+"{import.meta.env.PUBLIC_SKIMLINKS_ID}"+'.skimlinks.js';
					document.head.appendChild(s);
				}
			</script>
		)}
		<script is:inline>
			(function(){
				function assignVariant(){
					try{
						var key='ab:home-cta';
						var v=localStorage.getItem(key);
						if(!v){ v=Math.random()<0.5?'A':'B'; localStorage.setItem(key,v); }
						window.__variant=v;
						document.documentElement.setAttribute('data-variant', v);
					}catch(e){}
				}
				function sendEvent(detail){
					try{
						if(window.gtag){ window.gtag('event','click',{event_category:'interaction',...detail}); }
						var k='stats:click:'+(detail.name||'unknown');
						var c=Number(localStorage.getItem(k)||'0')+1; localStorage.setItem(k,String(c));
					}catch(e){}
				}
				document.addEventListener('DOMContentLoaded',function(){
					assignVariant();
					document.addEventListener('click',function(e){
						var el=e.target && e.target.closest && e.target.closest('[data-track]');
						if(!el) return;
						sendEvent({
							name: el.getAttribute('data-track'),
							variant: window.__variant || 'A',
							href: el.getAttribute('href')||null,
							id: el.getAttribute('data-id')||null,
							slug: el.getAttribute('data-slug')||null,
							type: el.getAttribute('data-type')||null,
							page: location.pathname
						});
					}, {capture:true});
					// Cookie banner
					if(!window.__consentGranted){
						var b=document.createElement('div');
						b.innerHTML='<div style="position:fixed;inset:auto 0 0 0;background:#111;color:#fff;padding:12px 16px;display:flex;gap:12px;align-items:center;justify-content:center;z-index:9999;font-size:12px;">本サイトは計測/アフィリエイトのためCookie等を使用します。<button id="cc-accept" style="background:#fff;color:#111;padding:6px 10px;border-radius:4px;">同意して続ける</button></div>';
						document.body.appendChild(b);
						document.getElementById('cc-accept').addEventListener('click', function(){ window.__grantConsent(); });
					}
				});
			})();
		</script>
	</head>
	<body class="min-h-screen bg-white text-gray-900">
		<Header />
		<main class="mx-auto max-w-6xl px-4 py-8">
			<slot />
		</main>
		<Footer />
	</body>

</html>


