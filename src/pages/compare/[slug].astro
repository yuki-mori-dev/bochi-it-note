---
import BaseLayout from "../../layouts/BaseLayout.astro";
import products from "../../../data/products.json";
import affiliates from "../../../data/affiliates.json";
import comparisons from "../../../data/comparisons.json";
import freshness from "../../../data/freshness.json";
import Breadcrumb from "../../components/Breadcrumb.astro";
import SponsorSlot from "../../components/SponsorSlot.astro";
import CrossSellTemplates from "../../components/CrossSellTemplates.astro";
export function getStaticPaths() {
  return comparisons.map(c => ({ params: { slug: c.slug } }));
}
const { slug } = Astro.params;
const page = comparisons.find(c => c.slug === slug);
if (!page) {
  throw new Error(`Comparison not found: ${slug}`);
}
const a = products.find(p => p.slug === page.productA);
const b = products.find(p => p.slug === page.productB);
if (!a || !b) {
  throw new Error(`Products not found for comparison: ${slug}`);
}
const title = `${a.name} vs ${b.name}｜要件適合比較`;
const description = `${a.name}と${b.name}をSSO/SCIM、IP制限、監査ログ、データ所在などで比較。`;
const fr = (freshness[a.slug]?.needsReview || freshness[b.slug]?.needsReview);
const useSkim = Boolean(import.meta.env.PUBLIC_SKIMLINKS_ID);
const affA = affiliates.find(x=>x.slug===a.slug);
const affB = affiliates.find(x=>x.slug===b.slug);
const hrefA = useSkim ? a.website : ((affA && affA.url) ? affA.url : a.website);
const hrefB = useSkim ? b.website : ((affB && affB.url) ? affB.url : b.website);
---

<BaseLayout {title} {description}>
	<script type="application/ld+json" is:inline>{JSON.stringify({
		"@context": "https://schema.org",
		"@type": "Article",
		"headline": `${a.name} vs ${b.name}`,
		"url": `https://bochi-it-note.com/compare/${page.slug}`,
		"about": [a.name, b.name],
		"dateModified": page.last_updated
	})}</script>
	<Breadcrumb items={[{name:'比較', href:'/compare/'},{name:`${a.name} vs ${b.name}`}]}/>
	<article class="prose prose-zinc max-w-none">
		<h1>{a.name} vs {b.name}</h1>
		<p>{page.summary}</p>
		{fr && <p class="mt-2 inline-flex items-center rounded bg-yellow-100 px-2 py-1 text-xs text-yellow-800">要確認: 出典の変更が検知されました</p>}
		<div class="overflow-x-auto"><table class="min-w-full">
			<thead>
				<tr class="sticky top-0 bg-white">
					<th class="px-2 py-1 text-left">項目</th>
					<th class="px-2 py-1 text-left">{a.name}</th>
					<th class="px-2 py-1 text-left">{b.name}</th>
				</tr>
			</thead>
			<tbody>
				<tr><td class="px-2 py-1">SSO</td><td class="px-2 py-1">{a.features.sso ? '対応' : '未対応'}</td><td class="px-2 py-1">{b.features.sso ? '対応' : '未対応'}</td></tr>
				<tr><td class="px-2 py-1">SCIM</td><td class="px-2 py-1">{a.features.scim ? '対応' : '未対応'}</td><td class="px-2 py-1">{b.features.scim ? '対応' : '未対応'}</td></tr>
				<tr><td class="px-2 py-1">IP制限</td><td class="px-2 py-1">{a.features.ipAllowlist ? '対応' : '未対応'}</td><td class="px-2 py-1">{b.features.ipAllowlist ? '対応' : '未対応'}</td></tr>
				<tr><td class="px-2 py-1">監査ログ</td><td class="px-2 py-1">{a.features.auditLog}</td><td class="px-2 py-1">{b.features.auditLog}</td></tr>
				<tr><td class="px-2 py-1">データ所在</td><td class="px-2 py-1">{a.features.dataResidency}</td><td class="px-2 py-1">{b.features.dataResidency}</td></tr>
			</tbody>
		</table></div>
		<div class="mt-4 flex flex-wrap gap-3">
			<a data-track="out_affiliate" data-type="product" data-slug={a.slug} class="inline-flex items-center gap-1 rounded-md bg-gray-900 px-3 py-2 text-sm text-white hover:bg-black" href={hrefA} target="_blank" rel="nofollow noopener sponsored">{a.name} 公式（紹介リンク）</a>
			<a data-track="out_affiliate" data-type="product" data-slug={b.slug} class="inline-flex items-center gap-1 rounded-md bg-gray-900 px-3 py-2 text-sm text-white hover:bg-black" href={hrefB} target="_blank" rel="nofollow noopener sponsored">{b.name} 公式（紹介リンク）</a>
		</div>
		<p class="mt-1 text-xs text-gray-500">一部リンクは紹介料を得る場合があります。<a class="underline" href="/affiliate-disclosure">表示について</a></p>
		<h3>出典</h3>
		<ul>
			{a.sources.map(s => <li><a href={s.url} target="_blank" rel="nofollow noopener">{a.name}: {s.title}<span aria-hidden="true" class="ml-1">↗</span></a></li>)}
			{b.sources.map(s => <li><a href={s.url} target="_blank" rel="nofollow noopener">{b.name}: {s.title}<span aria-hidden="true" class="ml-1">↗</span></a></li>)}
		</ul>
	</article>
	<SponsorSlot context="compare" tags={[...(a.category||[]), ...(b.category||[])]} />
	<CrossSellTemplates title="比較に役立つテンプレ" count={2} />
	<section class="mt-8">
		<h2 class="text-lg font-semibold">更新を受け取る</h2>
		<p class="mt-1 text-sm text-gray-600">比較や要件更新、テンプレ追加をお知らせします。</p>
		<div class="mt-3" set:html={import.meta.env.PUBLIC_NEWSLETTER_EMBED || ''}></div>
	</section>
	<section class="mt-10">
		<h2 class="text-lg font-semibold">関連製品</h2>
		<ul class="mt-3 grid gap-3 sm:grid-cols-2">
			<li class="rounded-md border p-4">
				<a href={`/products/${a.slug}`} class="font-semibold hover:underline">{a.name}</a>
				<p class="mt-1 text-sm text-gray-600">SSO: {a.features.sso ? '対応' : '未対応'} / SCIM: {a.features.scim ? '対応' : '未対応'}</p>
			</li>
			<li class="rounded-md border p-4">
				<a href={`/products/${b.slug}`} class="font-semibold hover:underline">{b.name}</a>
				<p class="mt-1 text-sm text-gray-600">SSO: {b.features.sso ? '対応' : '未対応'} / SCIM: {b.features.scim ? '対応' : '未対応'}</p>
			</li>
		</ul>
	</section>
	<div class="mt-8">
		<a href="/compare/" class="text-sm underline">比較一覧に戻る</a>
	</div>
</BaseLayout>


