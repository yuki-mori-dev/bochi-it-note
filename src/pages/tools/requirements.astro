---
import BaseLayout from "../../layouts/BaseLayout.astro";
import products from "../../../data/products.json";
const title = '要件で探す｜Bochi IT Note';
const description = 'SSO/SCIM、IP制限、データ所在、監査ログなどの要件でSaaSを絞り込み。';
---

<BaseLayout {title} {description}>
	<h1 class="text-2xl font-bold">要件で探す</h1>
	<p class="mt-2 text-sm text-gray-600">チェックした要件に対応する製品を表示します。</p>

	<div id="app" class="mt-6"></div>

	<script>
		const products = JSON.parse(`{JSON.stringify(products)}`);
		const state = {
			filters: {
				sso: false,
				scim: false,
				ipAllowlist: false,
				mfa: false
			}
		};

		function matches(p, f) {
			return Object.entries(f).every(([k, v]) => !v || Boolean(p.features?.[k]));
		}

		function render() {
			const root = document.getElementById('app');
			const filtered = products.filter(p => matches(p, state.filters));
			root.innerHTML = `
				<div class="grid gap-4 sm:grid-cols-[240px,1fr]">
					<aside class="rounded-md border p-4">
						<h2 class="font-semibold">要件</h2>
						<label class="mt-2 flex items-center gap-2 text-sm">
							<input type="checkbox" data-k="sso" /> SSO
						</label>
						<label class="mt-2 flex items-center gap-2 text-sm">
							<input type="checkbox" data-k="scim" /> SCIM
						</label>
						<label class="mt-2 flex items-center gap-2 text-sm">
							<input type="checkbox" data-k="ipAllowlist" /> IP制限
						</label>
						<label class="mt-2 flex items-center gap-2 text-sm">
							<input type="checkbox" data-k="mfa" /> 二要素認証
						</label>
					</aside>
					<section>
						<p class="text-sm text-gray-600">{filtered.length} 件</p>
						<ul class="mt-3 grid gap-3 sm:grid-cols-2">
							${filtered.map(p => `
								<li class="rounded-md border p-4">
									<a class="font-semibold hover:underline" href="/products/${p.slug}">${p.name}</a>
									<p class="mt-1 text-xs text-gray-600">SSO: ${p.features.sso ? '対応' : '未対応'} / SCIM: ${p.features.scim ? '対応' : '未対応'} / IP制限: ${p.features.ipAllowlist ? '対応' : '未対応'}</p>
								</li>
							`).join('')}
						</ul>
					</section>
				</div>
			`;
			root.querySelectorAll('input[type="checkbox"]').forEach(el => {
				el.checked = state.filters[el.dataset.k] ?? false;
				el.addEventListener('change', () => {
					state.filters[el.dataset.k] = el.checked;
					render();
				});
			});
		}

		render();
	</script>
</BaseLayout>


